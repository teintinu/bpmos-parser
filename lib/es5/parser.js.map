{"version":3,"sources":["parser.js"],"names":[],"mappings":";;;;;;;;;;;oBAAiB,SAAS;;;;wBACL,YAAY;;;;oBAEV,MAAM;;;;AAItB,SAAS,SAAS,CAAC,IAAI,EAAE;AAC9B,MAAI,YAAY,GAAG,YAAY,CAAC,IAAI,EAAE,OAAO,CAAC,CAAA;AAC9C,SAAO,KAAK,CAAC,IAAI,EAAE,YAAY,CAAC,CAAA;CACjC;;AAEM,SAAS,KAAK,CAAC,IAAI,EAAE,OAAO,EAAE;AACnC,MAAI,GAAG,GAAG,kBAAK,KAAK,CAAC,IAAI,EAAE,OAAO,EAAE,UAAS,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE;AAC5D,QAAI,IAAI,KAAK,OAAO,EAAC;AACnB,aAAO;AACL,aAAK,EAAE,IAAI;AACX,cAAM,EAAE,SAAS;AACjB,cAAM,EAAE,IAAI;AACZ,aAAK,EAAE,GAAG;OACX,CAAA;KACF,MAAM,IAAI,IAAI,KAAK,OAAO,EAAE;AAC3B,aAAO;AACL,aAAK,EAAE,IAAI;AACX,cAAM,EAAE,SAAS;AACjB,cAAM,EAAE,IAAI;AACZ,aAAK,EAAE,GAAG;OACX,CAAA;KACF,MAAM;AACL,UAAI,CAAC,MAAM,GAAG,SAAS,CAAA;AACvB,UAAI,CAAC,MAAM,GAAG,IAAI,CAAA;AAClB,UAAI,CAAC,KAAK,GAAG,GAAG,CAAA;AAChB,aAAO,IAAI,CAAA;KACZ;GACF,CAAC,CAAA;AACF,SAAO,aAAa,CAAC,oBAAS,IAAI,EAAE,OAAO,CAAC,EAAE,GAAG,CAAC,CAAA;CACnD;;AAEM,SAAS,aAAa,CAAC,GAAG,EAAE,IAAI,EAAE;AACvC,MAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;AAC3B,MAAI,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAA;AAClB,MAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC;AACrB,MAAI,GAAG,GAAG,sBAAS,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;AAC7C,MAAI,CAAC,GAAG,EAAE,OAAO,CAAC,GAAG,EAAE,wBAAwB,GAAC,IAAI,CAAC,CAAA;AACrD,MAAI,KAAK,GAAG,sBAAS,aAAa,CAAC,IAAI,CAAC,CAAC;AACzC,OAAK,CAAC,OAAO,CAAC,UAAU,IAAI,EAAC;AAC3B,QAAI,CAAC,GAAG,aAAa,CAAC,IAAI,EAAE,GAAG,EAAE,IAAI,CAAC,CAAA;AACtC,QAAI,CAAC,KAAK,SAAS,EAAE,GAAG,CAAC,IAAI,CAAC,GAAC,CAAC,CAAC;GAClC,CAAC,CAAA;AACF,SAAO,GAAG,CAAC;CACZ;;AAED,SAAS,aAAa,CAAC,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE;AACtC,MAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,IAAI,CAAA;AAC/B,MAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;AACnB,QAAI,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,IAAI,GAAE,cAAc,CAAC,CAAC;AAC3D,WAAO,SAAS,CAAC;GAClB;CACF;;AAED,SAAS,OAAO,CAAC,GAAG,EAAE,GAAG,EACzB;AACE,SAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;AAChB,MAAI,GAAG,GAAC,IAAI,KAAK,CAAC,CAChB,GAAG,EAAE,MAAM,EACX,GAAG,CAAC,MAAM,EAAE,GAAG,EACf,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,GAAG,EACvB,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;AAClC,KAAG,CAAC,IAAI,GAAG,GAAG,CAAC,MAAM,CAAC;AACtB,KAAG,CAAC,GAAG,GAAG,GAAG,CAAC,KAAK,CAAC;AACpB,QAAM,GAAG,CAAC;CACX","file":"parser.js","sourcesContent":["import yaml from '../yaml'\nimport artifact from './artifact'\n\nimport {basename} from 'path'\n\n// import {readFileSync} from 'fs'\n\nexport function parseFile(file) {\n  var file_content = readFileSync(file, 'utf-8')\n  return parse(file, file_content)\n}\n\nexport function parse(file, content) {\n  var obj = yaml.parse(file, content, function(type, node, loc) {\n    if (type === 'value'){\n      return {\n        $$val: node,\n        $$used: undefined,\n        $$file: file,\n        $$loc: loc\n      }\n    } else if (type === 'array') {\n      return {\n        $$arr: node,\n        $$used: undefined,\n        $$file: file,\n        $$loc: loc\n      }\n    } else {\n      node.$$used = undefined\n      node.$$file = file\n      node.$$loc = loc\n      return node\n    }\n  })\n  return parseArtifact(basename(file, '.yaml'), obj)\n}\n\nexport function parseArtifact(obj, name) {\n  var keys = Object.keys(obj)\n  var type = keys[0]\n  var obj2 = obj[type];\n  var ret = artifact.createArtifact(type, name)\n  if (!ret) throwAt(obj, 'invalid artifact type '+type)\n  var props = artifact.getProperties(type);\n  props.forEach(function (prop){\n    var p = parseProperty(prop, obj, obj2)\n    if (p !== undefined) ret[prop]=p;\n  })\n  return ret;\n}\n\nfunction parseProperty(prop, obj, obj2) {\n  if (obj2[prop.name]) obj = obj2\n  if (!obj[prop.name]) {\n    if (prop.required) throwAt(obj, prop.name +' is required');\n    return undefined;\n  }\n}\n\nfunction throwAt(obj, msg)\n{\n  console.dir(obj)\n  var err=new Error([\n    msg, ' at ',\n    obj.$$file, ':',\n    obj.loc.start.line, ':',\n    obj.loc.start.column].join(''));\n  err.file = obj.$$file;\n  err.loc = obj.$$loc;\n  throw err;\n}"],"sourceRoot":"/source/"}